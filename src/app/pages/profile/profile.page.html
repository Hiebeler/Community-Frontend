<div class="container mx-auto px-4 pt-4 pb-24">
  @if (user) {
  <div class="grid gap-4">
    @if (!editingImage) {
    <div class="flex justify-center">
      <img class="profile-image clickable" [src]="user.profileimage" alt="" width="100" height="100"
        (click)="editImage(true)" />
    </div>
    }

    @if (editingImage) {
    <app-profile-image-editor (closeEditor)="editImage(false)" />
    }

    @if (!editingName) {
    <div class="flex justify-center">
      <h2 class="clickable text-xl font-semibold" (click)="toggleNameEditor()">
        {{user.firstname + ' ' + user.lastname}}
      </h2>
    </div>
    }

    @if (editingName) {
    <div class="card p-4">
      <div class="flex gap-2 mb-4">
        <button type="button" class="btn-small btn-outline-danger flex-1" (click)="toggleNameEditor()">
          <ion-icon name="close-outline" class="text-2xl text-red-500"></ion-icon>
        </button>
        <button type="button"
          [disabled]="nameUpdateEditorForm.invalid || (firstname.value === user.firstname && lastname.value === user.lastname)"
          (click)="updateName()" class="btn-large btn-primary flex-1">Updaten</button>
      </div>

      <form class="flex gap-2 w-full" [formGroup]="nameUpdateEditorForm" (ngSubmit)="updateName()">
        <input type="text" id="firstname" autocomplete="off" formControlName="firstname" placeholder="Vorname"
          class="flex-1" />
        <input type="text" id="lastname" autocomplete="off" formControlName="lastname" placeholder="Nachname"
          class="flex-1" />
      </form>
    </div>
    }

    @if (!user.communities) {
    <div class="card p-4 text-center">
      <p>Noch keiner Gemeinschaft beigetreten</p>
      <div class="grid grid-cols-2 gap-4 mt-4">
        <button class="btn-large btn-primary w-full" (click)="gotoFindCommunity()">Beitreten</button>
        <button class="btn-large btn-outline-primary w-full" (click)="gotoCreateCommunity()">Erstellen</button>
      </div>
    </div>
    }

    @if (community) {
    <div class="grid grid-cols-2 gap-4">
      <div class="card text-center p-4">
        <h2 class="text-lg font-semibold">{{community.name}}</h2>
        <p class="text-sm">Gemeinschaft</p>
      </div>
      <div class="card text-center p-4">
        <h2 class="text-lg font-semibold">{{community.code}}</h2>
        <p class="text-sm">Beitrittscode</p>
      </div>
    </div>
    }

    @if (usersInCommunity.length) {
    <div class="card p-4">
      <p class="text-center mb-4">Mitglieder</p>
      <div class="flex flex-wrap gap-2 justify-center">
        @for (user of usersInCommunity; track user) {
        <div class="user-wrapper w-20 md:w-24 lg:w-28 text-center">
          <img [src]="user.profileimage" alt="" class="rounded-full w-full aspect-square object-cover mb-2" />
          <p class="text-xs">{{user.firstname}}</p>
          <p class="text-[0.7rem]">{{user.lastname}}</p>
        </div>
        }
      </div>
    </div>
    }

    @if (!editingColor) {
    <div class="grid grid-cols-2 gap-4">
      @if (community) {
      <div class="card flex justify-center items-center clickable p-4" (click)="editColor(true)">
        <p class="mr-2">Meine Farbe</p>
        <ion-icon [ngStyle]="{'color': user.color}" name="color-palette" class="text-xl"></ion-icon>
      </div>
      }
      <div class="card flex justify-center items-center clickable p-4" (click)="logout()">
        <p class="mr-2">Abmelden</p>
        <ion-icon name="log-out-outline" class="text-xl text-red-500"></ion-icon>
      </div>
    </div>
    }

    @if (editingColor) {
    <app-color-editor (closeEditor)="editColor(false)" />
    }

    <app-open-requests />
  </div>
  }
</div>
