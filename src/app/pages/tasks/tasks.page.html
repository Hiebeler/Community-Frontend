<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="getTasks($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="container">
    <ion-grid fixed="true">
      <ion-row class="topbar">
        <ion-col size="auto">
          <button type="button" class="btn-small btn-primary" (click)="gotoRoutines()">
            <ion-icon style="display: flex; font-size: 1.2rem;" color="dark" name="infinite-outline"></ion-icon>
          </button>
        </ion-col>
        <ion-col class="topbar-header-col">
          <p>Aufgaben
          </p>
        </ion-col>
        <ion-col size="auto" class="topbar-buttons-col">
          <button type="button" class="btn-small btn-medium" (click)="changeSelectedDays('previous')">
            <ion-icon style="display: flex; font-size: 1.2rem;" name="chevron-back-outline"></ion-icon>
          </button>
          <button type="button" class="btn-small btn-medium" (click)="changeSelectedDays('next')">
            <ion-icon style="display: flex; font-size: 1.2rem;" name="chevron-forward-outline"></ion-icon>
          </button>
        </ion-col>
      </ion-row>

      <ion-row class="ion-nowrap">
        @for (day of days; track day) {
          <ion-col class="day-col" [size]="84 / numberOfColumns"
            [ngClass]="day.date.toDateString() === dayToday.toDateString() ? 'today-col' : ''">
            @if (!isTodayDate(day.date, -1) && !isTodayDate(day.date, 0) && !isTodayDate(day.date, 1)) {
              <p class="ion-text-center p-weekday"
                >
              {{day.date.toLocaleDateString('de-AT', { weekday: 'short' })}}</p>
            }
            @if (isTodayDate(day.date, -1)) {
              <p class="ion-text-center p-weekday">Gestern</p>
            }
            @if (isTodayDate(day.date, 0)) {
              <p class="ion-text-center p-weekday">Heute</p>
            }
            @if (isTodayDate(day.date, 1)) {
              <p class="ion-text-center p-weekday">Morgen</p>
            }
            <p class="ion-text-center p-date">{{day.date.toLocaleDateString('de-AT', { year: 'numeric', month: 'short', day:
            'numeric' })}}</p>
            @for (task of day.openTasks; track task) {
              <div>
                <app-task-card [task]="task" (openModal)="openModal(task)"></app-task-card>
              </div>
            }
            <div class="task-div add-task-div" (click)="openModal(day.date)">
              +
            </div>
            @if (day.doneTasks[0]) {
              <div class="done-div">
                Erledigt:
              </div>
            }
            @for (task of day.doneTasks; track task) {
              <div>
                <app-task-card [task]="task" (openModal)="openModal(task)"></app-task-card>
              </div>
            }
          </ion-col>
        }
      </ion-row>
    </ion-grid>
  </div>

</ion-content>
