<div class="min-h-screen flex flex-col bg-gray-900 text-white">
  <main class="flex-1 overflow-auto container mx-auto px-4 py-6 space-y-6">

    <!-- Topbar -->
    <div class="flex items-center justify-between">
      @if (!editorIsOpen) {
      <button type="button" class="btn-small btn-primary" (click)="gotoHistory()">
        <lucide-icon [img]="receiptIcon"></lucide-icon>
      </button>
      }

      <p class="text-lg font-semibold">
        @if (!editorIsOpen) { Schulden }
        @else { Neue Schuld }
      </p>

      @if (!editorIsOpen) {
      <button type="button" class="btn-small btn-primary" (click)="openEditor(true)">
        <lucide-icon [img]="plusIcon"></lucide-icon>
      </button>
      }
    </div>

    <!-- New Debt Editor -->
    @if (editorIsOpen) {
    <form [formGroup]="itemEditorForm" (ngSubmit)="saveDebt()" class="bg-gray-800 rounded-xl p-4 space-y-4">

      <!-- Action Buttons -->
      <div class="flex justify-between items-center">
        <button type="button" class="btn-small btn-outline-danger w-1/4" (click)="openEditor(false)">
          <lucide-icon [img]="closeIcon" class="text-red-500"></lucide-icon>
        </button>
        <button type="button" class="btn-large btn-primary w-3/4" [disabled]="itemEditorForm.invalid"
          (click)="saveDebt()">
          Speichern
        </button>
      </div>

      <!-- Schuld Type Toggle -->
      <div class="flex space-x-2">
        <button type="button" class="btn-small w-1/2" [ngClass]="iOwe ? 'btn-primary' : 'bg-gray-700'"
          (click)="changeIOwe(true)">
          Ich Schulde
        </button>
        <button type="button" class="btn-small w-1/2" [ngClass]="!iOwe ? 'btn-primary' : 'bg-gray-700'"
          (click)="changeIOwe(false)">
          Ich Bekomme
        </button>
      </div>

      <!-- Schuldner -->
      <div>
        <p class="text-sm text-gray-300 mb-1">Schuldner:</p>
        <select formControlName="debitor" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
          @for (user of usersInCommunity; track user) {
          <option [ngValue]="user">{{user.firstname + ' ' + user.lastname}}</option>
          }
        </select>
      </div>

      <!-- Amount -->
      <div>
        <p class="text-sm text-gray-300 mb-1">Euro:</p>
        <input type="number" formControlName="amount" placeholder="Menge"
          class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
      </div>

      <!-- Reason -->
      <div>
        <p class="text-sm text-gray-300 mb-1">Grund:</p>
        <input type="text" formControlName="name" placeholder="Grund"
          class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
      </div>

    </form>
    }

    <!-- No Items -->
    @if (!allBalances.length) {
    <div class="flex flex-col items-center text-center space-y-2">
      <img src="./../../../../assets/images/no-debts.svg" alt="" class="w-4/5 max-w-[300px] rounded-lg">
      <h2 class="text-xl font-semibold">Alles Beglichenüëç</h2>
      <p class="text-sm text-gray-400">Klicke + um neue Schulden hinzuzuf√ºgen</p>
    </div>
    }

    <!-- Debt List -->
    @if (allBalances.length) {
    <div class="space-y-4">
      @for (balance of allBalances; track balance) {
      <div class="card">

        <!-- Card View -->
        @if (clearOffEditorIsOpenId !== balance.debitor.id) {
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <img [src]="balance.debitor.profileimage" alt="" class="w-10 h-10 rounded-full object-cover">
            <p class="font-medium">{{balance.debitor.firstname}} {{balance.debitor.lastname}}</p>
          </div>

          <button type="button" class="btn-small btn-primary" (click)="openClearOffEditor(balance)">
            <lucide-icon [img]="scaleIcon"></lucide-icon>
          </button>
        </div>

        <div class="flex flex-col items-center">
          <p class="text-sm text-gray-400">
            @if (balance.amount < 0) { {{balance.debitor.firstname}} schuldet mir } @if (balance.amount> 0) { Ich
              schulde {{balance.debitor.firstname}} }
          </p>

          <h2 [ngClass]="balance.amount < 0 ? 'text-green-400' : 'text-red-400'" class="text-3xl font-bold mt-2">
            {{balance.amount < 0 ? (balance.amount * -1) : balance.amount}} ‚Ç¨ </h2>
        </div>
        }

        <!-- Clear Off Editor -->
        @if (clearOffEditorIsOpenId === balance.debitor.id) {
        <form [formGroup]="clearOffBalanceEditorForm" (ngSubmit)="clearOffBalance(balance)" class="space-y-4">
          <div class="flex items-center space-x-2">
            <button type="button" class="btn-small btn-outline-danger w-1/4" (click)="openClearOffEditor()">
              <lucide-icon [img]="closeIcon" class="text-red-500"></lucide-icon>
            </button>

            <button type="button" class="btn-large btn-primary w-3/4" [disabled]="clearOffBalanceEditorForm.invalid"
              (click)="clearOffBalance(balance)">
              Begleichen
            </button>
          </div>

          <input type="number" formControlName="amount" placeholder="Amount"
            class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
        </form>
        }

      </div>
      }
    </div>
    }

  </main>
</div>
