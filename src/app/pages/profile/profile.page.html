<ion-content>
  <div class="container" style="padding-top: 15px">
    <ion-grid *ngIf="user">
      <ion-row *ngIf="!editingImage">
        <ion-col style="display: flex; justify-content: center">
          <img class="profileimage" [src]="user.profileimage" alt="" height="100" width="100" (click)="editImage(true)">
        </ion-col>
      </ion-row>

      <ion-row *ngIf="editingImage" class="editing-image-row ion-padding">

        <ion-col size="21" style="display: flex; justify-content: center">
          <button type="button" class="btn-small btn-dark" style="width: 100%;"
            (click)="editImage(false)">Schließen</button>
        </ion-col>

        <ion-col size="21" style="display: flex; justify-content: center">
          <button *ngIf="cropImgPreview" type="button" class="btn-small btn-primary" style="width: 100%;"
            (click)="saveImage()">Speichern</button>
          <button *ngIf="!cropImgPreview" type="button" class="btn-small btn-disabled"
            style="width: 100%;">Speichern</button>
        </ion-col>

        <ion-col size="42">
          <input type="file" (change)="onFileChange($event)" />
        </ion-col>

        <ion-col size="42">
          <image-cropper [imageChangedEvent]="imgChangeEvt" [maintainAspectRatio]="true" [aspectRatio]="4 / 4"
            [resizeToWidth]="256" format="jpeg" (imageCropped)="cropImg($event)" (imageLoaded)="imgLoad()"
            (cropperReady)="initCropper()" (loadImageFailed)="imgFailed()" [roundCropper]="true">
          </image-cropper>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col style="display: flex; justify-content: center">
          <h2>{{user.firstname + ' ' + user.lastname}}</h2>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="!user.communityId">
        <ion-col class="card-flex">
          <div class="card card-center-text" style="padding: 10px;">
            <p style="text-align: start">Noch keiner Community beigetreten</p>
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="community">
        <ion-col class="card-1-flex" size="21">
          <div class="card card-center-text">
            <h2>{{community.name}}</h2>
            <p>Community</p>
          </div>
        </ion-col>

        <ion-col class="card-1-flex" size="21">
          <div class="card card-center-text">
            <h2>{{community.code}}</h2>
            <p>Beitrittscode</p>
          </div>

        </ion-col>
      </ion-row>

      <ion-row *ngIf="usersInCommunity">
        <ion-col>
          <ion-grid class="card card-no-center ion-no-margin">
            <ion-row>
              <ion-col style="display: flex;">
                <p style="text-align: start">Mitglieder:</p>
              </ion-col>
            </ion-row>

            <ion-row *ngFor="let user of usersInCommunity">
              <ion-col size="auto">
                <img class="rounded-image" [src]="user.profileimage" alt="" height="20" width="20" (click)="editImage(true)">
              </ion-col>
              <ion-col>
                <p>{{user.firstname + ' ' + user.lastname}}</p>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="!editingColor">
        <ion-col class="card-1-flex" size="21">
          <div class="card card-center-text clickable" (click)="editColor(true)" [ngStyle]="{'background-color': user.color}">
            <p>Meine Farbe</p>
          </div>
        </ion-col>

        <ion-col class="card-1-flex" size="21">
          <div class="card card-center-text wrapper-logout clickable" (click)="logout()">
            <p>Abmelden</p>
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="editingColor">
        <ion-col class="card-flex">
          <ion-grid class="card card-center-text ion-no-margin">
            <ion-row>
              <ion-col style="display: flex; justify-content: center">
                <button type="button" class="btn-small btn-dark" (click)="editColor(false)">Schließen</button>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col>
                <p>Farbe auswählen:</p>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col size="14" *ngFor="let color of colors" (click)="changeColor(color.color)">
                <div class="color-selection-field" [ngStyle]="{'background-color': color.color}"
                  [ngClass]="{'active-color': color.username === user.firstname, 'clickable': color.username === ''}">
                  <p *ngIf="color.username">{{color.username}}</p>
                </div>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-col>
      </ion-row>


      <ion-row *ngIf="requests">
        <ion-col *ngFor="let request of requests">
          <h1>Requests:</h1>
          <ion-grid class="requests-wrapper">
            <ion-row>
              <ion-col>
                <h1 class="ion-text-center">{{request.user.firstname}}</h1>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col>
                <button type="button" class="btn-small btn-primary" (click)="accept(request.id)">Annehmen</button>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>
